# Drone Game Envionment Simulation Project: Instructions for Simulation

A dynamic drone navigation game where the objective is to control a drone to collect as many targets as possible, while also avoiding collisions with obstacles.

## 1- Installation and Running

- Prerequisites
    - GCC compiler (can be installed via `sudo apt-get install build-essential`)
    - `ncurses` library (can be installed via `sudo apt-get install libncurses5-dev`)
    - `make` (can be installed via `sudo apt-get install make`)

- Building and Running the Simulation
    1.  Navigate to the project directory: 
        ```bash
        cd proj_DroneGame/
        ```
    2.  Run the following command to build the project:
        ```bash
        make
        ```
        This will generate an executable named `arp1`.
    3. Run the executable:
        ```bash
        ./arp1
        ```
    4. Clean: To remove all compiled files and start fresh
        ```bash
        make clean
        ```

## 2- Operational Instructions

- A full-screen **ncurses** interface appears.
- The screen is divided into:
  - **Left world panel** (drone, obstacles, targets)
  - **Right inspection panel** (state, forces, score, logs)

During execution:

- The **Keyboard process (I)** captures your keypresses.
- The **Blackboard Server (B)** updates forces, world state, UI, scoring.
- The **Dynamics process (D)** simulates the drone motion.
- The **Obstacle generator (O)** and **Target generator (T)** periodically spawn entities.

To exit cleanly, press `q` at any moment.

## 3- Game Rules
-   **Objective**: Fly the drone to collect as many **Targets** (Green `+`) as possible.
-   **Avoid**: **Obstacles** (Orange `O`).
-   **Physics**: The drone has physical properties (mass, viscosity) and inertia. A continuous *force* applied to it is controlled by the keyboard in a corresponding direction.
-   **Inspection**: The right panel shows the current state (Position, Velocity) and Score, and the time elapsed since a prior target has been collected.
-   **Run-time configuration**: Simulation parameters like Mass (`M`), Viscosity (`K`), and Time step (`dt`) can be modified in `params.txt` file.

## 4- Controls

### Directional Force Controls

```text
    w   e   r
    s   d   f
    x   c   v
```
Each press adds force in that direction:
- `w` → up-left  
- `e` → up  
- `r` → up-right  
- `s` → left  
- `d` → brake (zero force)  
- `f` → right  
- `x` → down-left  
- `c` → down  
- `v` → down-right  

### Special Commands
| Key | Function                          |
|-----|-----------------------------------|
| `d` | Brake (zero user-applied force)   |
| `p` | Pause / resume the simulation     |
| `O` | Reset drone position & velocity   |
| `q` | Quit the entire system            |

## 5- Behavior

The following describes how the drone world responds to user actions and how the different components interact.

### Drone Dynamics
- Simulated dynamic model.
- Numerical integration using timestep `dt` from `params.txt`.
- Smooth, continuous acceleration from user forces.

### Wall Repulsion
- Implemented in the **Dynamics process (D)**.
- When the drone approaches ±`world_half`, a **Khatib repulsive** force pushes it inward.
- Prevents the drone from crossing the world boundaries.

### Obstacle Behavior

- Obstacles are periodically generated by process **O**:
  - Sampled inside an inner **safe region**.
  - Respect minimum spacing between obstacles.
- The Server (B) adds **virtual-key repulsion**:
  - Computes a continuous **Khatib repulsive** vector.
  - Projects that vector onto the 8 control directions.
  - Applies the strongest direction as a “virtual key press”.

### Target Behavior
- Targets are generated by **T**:
  - In a central disk region.
  - Fairly away from walls and obstacles.
- When the drone’s distance to a target < `R_hit`:
  - The target is **collected**.
  - Score increments.
  - Time of last hit is recorded.

### Spawning behavior
- Each obstacle/target has a finite lifetime measured in simulation steps.
- Expired entities disappear automatically.
- B only accepts a new obstacle batch if no active obstacles remain.
- Targets may spawn even if obstacles exist, but unsafe targets are filtered.

### Pause Behavior
- Drone motion, world state and entity lifetimes freeze. 
- UI still updates to show paused status.
- Forces are zeroed. 
- Lifetimes for obstacles and targets do not decrement.  
- No new obstacle and target spawn batches are accepted.  